commonfields:
  id: Intsights_Integration_Python
  version: 159
name: Intsights_Integration_Python
display: Intsights_Integration_Python
category: Authentication
image: data:image/png;base64,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
configuration:
- display: ""
  name: api_url
  defaultvalue: ' https://api.intsights.com/'
  type: 0
  required: false
- display: ""
  name: api_key
  defaultvalue: d820003043adcbf36c2d8e8ad89e1de34be95b2b77a6022f5624967131132badc449513868009f955b49388e1b0a4bf88e64a41794e40516e1829f361a92f34d
  type: 0
  required: true
- display: ""
  name: account_id
  defaultvalue: 577d1dcfdaaafdcd0799f0f4
  type: 0
  required: true
- display: use system proxy settings
  name: proxy
  defaultvalue: "False"
  type: 0
  required: false
- display: trust any certificate
  name: insecure
  defaultvalue: "True"
  type: 0
  required: false
- display: ""
  name: Account-id
  defaultvalue: ""
  type: 0
  required: false
script:
  script: |-
    import requests
    import json
    import sys
    from requests.auth import HTTPBasicAuth
    import urllib
    import os
    def set_proxies():

        if demisto.params()['proxy']:
            http = os.environ['http_proxy'] or os.environ['HTTP_PROXY']
            https = os.environ['https_proxy'] or os.environ['HTTPS_PROXY']
            proxies = {
                'http': http,
                'https': https
            }
            return proxies
        return None
    api_server=demisto.params()['api_url']
    api_key=demisto.params()['api_key']
    account_id=demisto.params()['account_id']
    USE_SSL = not demisto.params()['insecure']
    Account_id=demisto.params()['Account-id']
    PROXIES = set_proxies()
    auth_url= api_server
    auth_url=auth_url.rstrip()
    headers={'Content-Type': 'application/json','Accept': 'application/json','Account-Id': '56fa717fb6c16ba1033a3ab5'}

    # The command demisto.command() holds the command sent from the user.
    if demisto.command() == 'test-module':

        response = requests.request(
            'GET',
            auth_url,
            headers=headers,
            verify=USE_SSL,
            proxies=PROXIES,
            auth=HTTPBasicAuth(account_id,api_key)
        )

        demisto.results(response.text)
        demisto.results('ok')


        sys.exit(0)
        #demisto.results('ok')

        #sys.exit(0)
    if demisto.command()=='alert_list_ini':
        auth_url1='https://api.intsights.com/public/v1/data/alerts/alerts-list'
        response1 = requests.get(
            auth_url1,
            headers=headers,
            auth=HTTPBasicAuth(account_id,api_key)
        )
        demisto.results(response1.content)
        ec = {}
        ec["FileData"] = response1.content
        demisto.results({
            "Type" : entryTypes["note"],
            "ContentsFormat" : formats["json"],
            "Contents" : response1.content,
            "EntryContext" : ec})
       # sys.exit(0)

    if demisto.command()=='alert_list_tre':
        proxy='https://proxy4.wipro.com:8080'
        proxyDict={'https':proxy,'http':proxy}
        #account_id='577d1dcfdaaafdcd0799f0f4'
      #  api_key='d820003043adcbf36c2d8e8ad89e1de34be95b2b77a6022f5624967131132badc449513868009f955b49388e1b0a4bf88e64a41794e40516e1829f361a92f34d'
        auth_url='https://api.intsights.com/public/v1/data/alerts/alerts-list'
        auth_url=auth_url.rstrip()
        demisto.results(auth_url)
        headers={'Content-Type': 'application/json','Accept':'application/json','Account-Id':'56fa717fb6c16ba1033a3ab5'}
        r=requests.get(auth_url,auth=HTTPBasicAuth(account_id,api_key),headers=headers)
        demisto.results(r.content)

    if demisto.command()=='get_account_used_hours':
        auth_url1=demisto.args()['url1']
        auth_url1=auth_url1.rstrip()
        headers={'Content-Type': 'application/json','Accept':'application/json','Account-Id':'56fa717fb6c16ba1033a3ab5'}
        r1=requests.get(auth_url1,auth=HTTPBasicAuth(account_id,api_key),headers=headers)
        demisto.results(r1.content)

    if demisto.command()=='ask_the_analyst':

        auth_url2=demisto.args()['url2']
        question=demisto.args()['ask_the_question']
        auth_url2=auth_url2.rstrip()
        r2=requests.post(auth_url2,auth=HTTPBasicAuth(account_id,api_key),headers=headers)
        demisto.results(r2.content)





    if demisto.command() == 'fetch-incidents':
        # You can store the last run time...
        demisto.setLastRun({'time': 'now'})
        # And retrieve it for use later:
        lastRun = demisto.getLastRun()
        res=getAlerts(lastRun)
        demisto.results(res.Data)
        incidents=[]
        for i in res.Data.length():
            alert=res.Data[i]
            incidents.push(createIncidentFromAlert(alert))
        # lastRun is a dictionary, with value "now" for key "time".
        # JSON of the incident type created by this integration
        demisto.incidents([{"Name":"Incident #1"},{"Name":"Incident #2"}])
        sys.exit(0)

    # You can use demisto.args()[argName] to get a specific arg. args are strings.
    # You can use demisto.params()[paramName] to get a specific params.
    # Params are of the type given in the integration page creation.
  type: python
  commands:
  - name: alert_list_ini
    arguments: []
  - name: alert_list_tre
    arguments: []
  - name: get_account_used_hours
    arguments:
    - name: url1
      required: true
      default: true
      defaultValue: https://api.intsights.com/public/v1/account/used-hours
  - name: ask_the_analyst
    arguments:
    - name: url2
      required: true
      defaultValue: https://api.intsights.com/public/v1/data/alerts/ask-the-analyst/56fb77fa0b83f589038a97b2
    - name: ask_the_question
      required: true
      default: true
  - name: fetch-incidents
    arguments: []
  runonce: false
